"use strict";(self.webpackChunkChemicalDetection=self.webpackChunkChemicalDetection||[]).push([[908],{85908:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});a(57658);var s=a(2670),i=a(55743),r=a.n(i),l=a(48368);let o={Desc:"导入数据查询",Url:{query:"/api/externalDataSource/query",Save:"/api/externalDataSource/addOrUpdate",GetList:"/api/externalDataSource/list",Delete:"/api/externalDataSource/delete"},DetailFilter:t=>(t.create_time=r()(t.create_time).isValid()?r()(t.create_time).format("YYYY-MM-DD HH:mm:ss"):null,t.update_time=r()(t.update_time).isValid()?r()(t.update_time).format("YYYY-MM-DD HH:mm:ss"):null,t),EditRules:{sourceCode:[{required:!0,message:"请输入数据源编号",trigger:"blur"}],sourceName:[{required:!0,message:"请输入数据源名称",trigger:"blur"}],dataSourceInfo:[{required:!0,message:"请输入数据来源",trigger:"blur"}]},EditFilter:t=>Object.assign({id:0},t),SaveFilter:t=>Object.assign({},t),SaveFilterEnd:async t=>{await(0,l.Z)("/api/Common/SaveAttachments",[{tableName:"t_hotnews",type:"Img",tableID:t.fid,relativePaths:t._Attachment_Img.map((t=>t.url))}])}};var d=o,n={extends:s.AS,data(){return{labelCol:{span:8},wrapperCol:{span:15},schema:d,dTb:{rows:[],colunms:[],rows_chks:[],load:!1,pagination:{current:1,total:0,pageSize:15},size:"middle"}}},methods:{fnBack(){this.$router.push({name:"analy",params:{path:"externalData"}})}},created(){this.Init(0)}},m=(0,a(1001).Z)(n,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"mainmx"},[t._m(0),e("div",{staticClass:"main-deep-com"},[e("div",{staticClass:"box-top flexce"},[e("a-button",{attrs:{icon:"export"},on:{click:function(e){return t.fnBack()}}},[t._v("返回")])],1),e("div",[null!=t.dObj.mod?e("a-form-model",{ref:"editref",attrs:{layout:"Inline",model:t.dObj.mod,rules:t.dObj.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[e("a-row",{staticClass:"column2"},[e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"线索项目：",prop:"rulesName"}},[e("a-input",{attrs:{placeholder:"请输入规则名称",allowClear:""},model:{value:t.dObj.mod.rulesName,callback:function(e){t.$set(t.dObj.mod,"rulesName",e)},expression:"dObj.mod.rulesName"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"数据类型：",prop:"sort"}},[e("a-input",{attrs:{allowClear:""},model:{value:t.dObj.mod.sort,callback:function(e){t.$set(t.dObj.mod,"sort",e)},expression:"dObj.mod.sort"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"时间范围：",prop:"analySort"}},[e("a-input",{attrs:{allowClear:""},model:{value:t.dObj.mod.analySort,callback:function(e){t.$set(t.dObj.mod,"analySort",e)},expression:"dObj.mod.analySort"}})],1)],1)],1),e("a-row",{staticClass:"column2"},[e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"数据源：",prop:"sort"}},[e("a-input",{attrs:{allowClear:""},model:{value:t.dObj.mod.sort,callback:function(e){t.$set(t.dObj.mod,"sort",e)},expression:"dObj.mod.sort"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"查找：",prop:"analySort"}},[e("a-input",{attrs:{allowClear:""},model:{value:t.dObj.mod.analySort,callback:function(e){t.$set(t.dObj.mod,"analySort",e)},expression:"dObj.mod.analySort"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",[e("a-button",[t._v("查询")])],1)],1)],1)],1):t._e(),e("a-table",{attrs:{columns:t.dTb.colunms.filter((t=>t.show)),rowKey:t=>t.id,dataSource:t.dTb.rows,pagination:t.dTb.pagination,loading:t.dTb.load}})],1)])])}),[function(){var t=this._self._c;return t("div",{staticStyle:{"margin-bottom":"15px"}},[t("div",{staticClass:"main-tit-top"},[this._v("数据管理")])])}],!1,null,"753c27ae",null).exports},2670:function(t,e,a){a.d(e,{AS:function(){return o},en:function(){return r},v6:function(){return l}});var s=a(55743),i=a.n(s);const r={data(){return{dQparm:{},dTb:{rows:[],colunms:[],rows_chks:[],load:!1,pagination:{current:1,total:0,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,e)=>`共${t}条数据 当前从${e[0]}~${e[1]}条`},size:"defalut"}}},mounted(){this.dTb.colunms=this.schema.ListCols,this.fnTb_Query()},methods:{async fnTb_Query(t,e,a){this.dTb.pagination.current=t&&t.current||1,this.dTb.pagination.pageSize=t&&t.pageSize||10,this.dQparm.pageIndex=this.dTb.pagination.current,this.dQparm.pageSize=this.dTb.pagination.pageSize,this.dTb.load=!0;let s=await this.$api2(this.schema.Url.GetCount,this.dQparm);if(s.isOk){let t=parseInt(s.data);if(t>0){this.dTb.pagination.total=t;let e=await this.$api2(this.schema.Url.GetList,this.dQparm);e.isOk?this.dTb.rows=this.schema.ListFilter&&await this.schema.ListFilter(e.data)||e.data:this.$message.error(e&&e.message||this.schema.Desc+"数据列表查询失败")}else this.dTb.rows=[]}else this.$message.error(s&&s.message||this.schema.Desc+"数据分页统计失败");this.dTb.load=!1},async fnTb_Del(t){if(!t||t.length<=0)return this.$message.error("请选择要删除的"+this.schema.Desc+"数据");let e=this;this.$confirm({title:"操作确认",content:"确认删除当前选中的"+t.length+"条记录",onOk(){e.$api2(e.schema.Url.Delete,t).then((t=>{t&&t.isOk?(e.$message.success(e.schema.Desc+"数据已成功删除"),e.fnTb_Query()):e.$message.error(t&&t.message||"数据删除失败")}))}})}},filters:{time(t,e="YYYY-MM-DD HH:mm:ss"){let a=i()(t);return a.isValid()?a.format(e):null}}},l={data(){return{dObj:{show:!1,load:!1,mod:null,title:""}}},mounted(){this.dObj.title=this.schema&&this.schema.Desc||""},methods:{async Init(t,e="fid"){if(!(t&&t>0))return;this.dObj.mod=null,this.dObj.show=!0,this.dObj.load=!0;let a="fid"==e?{fid:t}:{id:t},s=await this.$api2(this.schema.Url.Get,null,a);this.dObj.load=!1,s&&s.isOk&&null!=s.data?this.dObj.mod=this.schema.DetailFilter&&await this.schema.DetailFilter(s.data)||s.data:this.$message.error(s&&s.message||this.schema.Desc+"可预览信息查询失败")}}},o={data(){return{dObj:{show:!1,load:!1,mod:null,title:"",rules:null}}},mounted(){this.dObj.title=this.schema.Desc||"",this.dObj.rules=this.schema.EditRules||null},methods:{async Init(t,e="fid"){if(parseInt(t)>=0){if(this.dObj.mod=null,this.dObj.show=!0,0==t)this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(null);else{this.dObj.load=!0;let a="fid"==e?{fid:t}:{id:t},s=await this.$api2(this.schema.Url.Get,null,a);s&&s.isOk&&null!=s.data?this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(s.data)||s.data:this.$message.error(s&&s.message||this.schema.Desc+"可编辑信息查询失败"),this.dObj.load=!1}this.$refs.editref&&this.$refs.editref.resetFields&&this.$refs.editref.resetFields()}},async Save(){this.$refs.editref.validate((async t=>{if(!t)return this.$message.error("输入数据校验失败，请重新输入"),!1;{this.dObj.load=!0;let t=this.schema.SaveFilter&&this.schema.SaveFilter(this.dObj.mod)||this.dObj.mod,e=await this.$api2(this.schema.Url.Save,t);this.dObj.load=!1,e&&e.isOk?parseInt(e.data)>0?(this.$message.success(this.schema.Desc+"数据保存成功"),this.schema.SaveFilterEnd&&(this.dObj.mod.fid=e.data,this.schema.SaveFilterEnd(this.dObj.mod)),this.dObj.show=!1,this.$emit("emOk",!0)):this.$message.error("数据保存失败"):this.$message.error(e&&e.message||this.schema.Desc+"数据保存失败")}}))},async Cancel(){this.dObj.show=!1,this.dObj.mod=null}}}}}]);