"use strict";(self.webpackChunkChemicalDetection=self.webpackChunkChemicalDetection||[]).push([[929],{71742:function(e,t,a){a.d(t,{Z:function(){return n}});var i=a(13054),s=a(45871),l={name:"NingDeMap3d",mixins:[],props:{},components:{},data(){return{areaCode:0,modalType:"normal"}},watch:{},methods:{closeModal(){s.Z.setAreaCode(0)}},beforeCreate(){},created(){},beforeMount(){},mounted(){i.Z.setContainer(this.$refs.container)},beforeUpdate(){},updated(){},beforeDestory(){},destroyed(){},computed:{}},n=(0,a(1001).Z)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"NingDeMap3d"},[t("div",{ref:"container",staticClass:"container"}),t("div",{directives:[{name:"show",rawName:"v-show",value:"normal"===e.modalType&&e.areaCode>0,expression:"modalType === 'normal' && areaCode > 0"}],ref:"normalModal",staticClass:"modal"},[t("div",{staticClass:"modal_container"},[t("button",{on:{click:e.closeModal}},[e._v("关闭")]),e._v(" "+e._s(e.areaCode)+" 案件数弹窗 ")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:"alarm"===e.modalType&&e.areaCode>0,expression:"modalType === 'alarm' && areaCode > 0"}],ref:"alarmModal",staticClass:"modal"},[t("div",{staticClass:"modal_container"},[t("button",{on:{click:e.closeModal}},[e._v("关闭")]),e._v(" "+e._s(e.areaCode)+" 警告弹窗 ")])])])}),[],!1,null,"1cf4fdd7",null).exports},11928:function(e,t,a){a.d(t,{Z:function(){return m}});var i=a(2670),s=a(28511),l=a(26839),n=a(21438),r={props:{pSrc:String||""},components:{FilePreview:n.Z},data(){return{dFileList:[],dLoad:!1,previewVisible:!1,previewImage:""}},mounted(){this.fnInit()},methods:{fnInit(){this.pSrc&&this.pSrc.length>0?this.dFileList=[{url:"/g3"+this.pSrc,uid:"-1",name:"image.png",status:"done"}]:this.dFileList=[]},async fnPreview(e){this.$refs.FilePreview.Init(e.url)},async fnChange(e){if(this.dFileList=[...e.fileList].slice(-1),this.dLoad="uploading"===e.file.status,"done"===e.file.status){let t=e.file.response;t&&t.length>0&&(this.dFileList[0].url="/g3"+t[0],this.$emit("update:pSrc",t[0],e.file.name))}"removed"===e.file.status&&this.$emit("update:pSrc","")}},watch:{pSrc(e){this.fnInit()}}},o=a(1001),d=(0,o.Z)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"clearfix"},[t("a-upload",{attrs:{action:"/g2/api/File/UploadFiles","list-type":"picture-card","file-list":e.dFileList,name:"files"},on:{preview:e.fnPreview,change:e.fnChange}},[e.dFileList.length<=0?t("div",[t("a-icon",{attrs:{type:"plus",color:"#1890ff"}}),t("a-button",{staticStyle:{"margin-top":"8px"},attrs:{type:"primary",size:"small"}},[e._v("选择文件")])],1):e._e()]),t("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:function(t){e.previewVisible=!1}}},[t("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})]),t("FilePreview",{ref:"FilePreview"})],1)}),[],!1,null,null,null).exports,h={extends:i.AS,components:{Upload:d},data(){return{schema:s.Z,DICT_AttachmentList:[],TableID_Name:null,isCom:!1}},async created(){this.DICT_AttachmentList=[{label:"未选择",value:""},...(await(0,l.ig)("DICT_AttachmentList")).map((e=>({label:e.comment,value:e.name})))]},methods:{fnSetPro(e,t,a){this.TableID_Name=a,e&&e.length>0&&(this.dObj.mod.tableName=e),t&&parseInt(t)>0&&(this.dObj.mod.tableID=t),this.isCom=!0},fnFileChange(e,t){this.$refs.relativePath.onFieldChange(),null!=this.dObj.mod.name&&0!=this.dObj.mod.name.length||this.dObj.mod.relativePath.length>0&&(this.dObj.mod.name=t)}}},m=(0,o.Z)(h,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{visible:e.dObj.show,title:(e.TableID_Name||"")+" "+e.dObj.title+(e.dObj.mod&&e.dObj.mod.fid>0?"编辑":"新增"),width:860,maskClosable:!1},on:{ok:function(t){return e.Save()},cancel:function(t){e.dObj.show=!1}}},[t("a-spin",{attrs:{spinning:e.dObj.load,tip:e.dObj.title+"可编辑数据加载中..."}},[t("div",{style:e.dObj.load?"min-height:280px":""},[null!=e.dObj.mod?t("a-form-model",{ref:"editref",staticClass:"inline-form",attrs:{model:e.dObj.mod,rules:e.dObj.rules,labelCol:{style:{width:"120px"}},layout:"horizontal",labelAlign:"left"}},[t("input",{attrs:{type:"hidden"},domProps:{value:e.dObj.mod.fid}}),t("a-row",{attrs:{gutter:[0,0]}},[t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"文件名",prop:"name"}},[t("a-input",{attrs:{placeholder:"请输入文件名",allowClear:""},model:{value:e.dObj.mod.name,callback:function(t){e.$set(e.dObj.mod,"name",t)},expression:"dObj.mod.name"}})],1)],1),e.isCom?e._e():t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"文件归属",prop:"tableName"}},[t("a-select",{attrs:{placeholder:"选择文件归属",options:e.DICT_AttachmentList},model:{value:e.dObj.mod.tableName,callback:function(t){e.$set(e.dObj.mod,"tableName",t)},expression:"dObj.mod.tableName"}})],1)],1),e.isCom?e._e():t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"归属ID",prop:"tableID"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入归属ID",allowClear:"",disabled:""==e.dObj.mod.tableName},model:{value:e.dObj.mod.tableID,callback:function(t){e.$set(e.dObj.mod,"tableID",t)},expression:"dObj.mod.tableID"}})],1)],1),t("a-col",{attrs:{span:24}},[t("a-form-model-item",{ref:"relativePath",attrs:{label:"选择文件",prop:"relativePath",autoLink:!1}},[t("Upload",{attrs:{pSrc:e.dObj.mod.relativePath},on:{"update:pSrc":[function(t){return e.$set(e.dObj.mod,"relativePath",t)},(t,a)=>e.fnFileChange(t,a)],"update:p-src":function(t){return e.$set(e.dObj.mod,"relativePath",t)}}})],1)],1)],1)],1):e._e()],1)])],1)}),[],!1,null,null,null).exports},35512:function(e,t,a){a.d(t,{Z:function(){return r}});var i=a(28511),s=a(11928),l=a(21438),n={components:{AttachmentEdit:s.Z,FilePreview:l.Z},data(){return{schema:i.Z,loading:!0,loadingMore:!1,showLoadingMore:!0,data:[]}},props:{TableName:{type:String},TableID:{type:Number},TableID_Name:{type:String},ops:{type:Array,default:["preview","down","edit","delete"]}},mounted(){this.fnTb_Query()},methods:{async fnTb_Query(){let e={TableID:this.TableID,TableName:"t_clue",pageIndex:0,pageSize:10},t=await this.$api2(i.Z.Url.GetCount,e);if(t&&t.isOk){if(parseInt(t.data)>0){let t=await this.$api2(i.Z.Url.GetList,e);t&&t.isOk&&(this.data=[].concat(t.data))}}this.loading=!1,this.loadingMore=!1,this.showLoadingMore=!1},async fnRefEdit(e=0){await this.$refs.refAttachmentEdit.Init(e),await this.$refs.refAttachmentEdit.fnSetPro(this.TableName,this.TableID,this.TableID_Name)},async fnTb_Del(e){if(!e||e.length<=0)return this.$message.error("请选择要删除的"+this.schema.Desc+"数据");let t=this;this.$confirm({title:"操作确认",content:"确认删除当前选中的"+e.length+"条记录",onOk(){t.$api2(t.schema.Url.Delete,e).then((e=>{e&&e.isOk?(t.$message.success(t.schema.Desc+"数据已成功删除"),t.fnTb_Query()):t.$message.error(e&&e.message||"数据删除失败")}))}})}}},r=(0,a(1001).Z)(n,(function(){var e=this,t=e._self._c;return t("div",{staticStyle:{margin:"0 15px"}},[t("a-list",{attrs:{loading:e.loading,"item-layout":"vertical","data-source":e.data},scopedSlots:e._u([{key:"renderItem",fn:function(a,i){return t("a-list-item",{},[t("a-list-item-meta",[t("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(a.name))]),t("span",{attrs:{slot:"description"},slot:"description"},[t("span",[e._v("更新于："+e._s(e._f("DATE")(a.uploadDate)))])])]),t("div",{staticClass:"flexce"},[t("a-space",[e.ops.indexOf("preview")>=0?[t("a",{on:{click:function(t){return e.$refs.FilePreview.Init("/g3"+a.relativePath,null,a.name)}}},[e._v("预览")])]:e._e(),e.ops.indexOf("down")>=0?[t("a",{on:{click:function(t){return e.$refs.FilePreview.Down("/g3"+a.relativePath,null,a.name)}}},[e._v("下载")])]:e._e(),e.ops.indexOf("edit")>=0?[t("a",{on:{click:function(t){return e.fnRefEdit(a.fid)}}},[e._v("修改")])]:e._e(),e.ops.indexOf("delete")>=0?[t("a",{on:{click:function(t){return e.fnTb_Del([a.fid])}}},[e._v("删除")])]:e._e()],2)],1)],1)}}])},[e.showLoadingMore?t("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[e.loadingMore?t("a-spin"):t("a-button",[e._v("加载更多")])],1):e._e()]),t("AttachmentEdit",{ref:"refAttachmentEdit",on:{emOk:function(t){return e.fnTb_Query()}}}),t("FilePreview",{ref:"FilePreview"})],1)}),[],!1,null,"5c40b70a",null).exports},27929:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});var i=a(71742),s=a(35512),l={components:{NingDeMap3d:i.Z,Files:s.Z},data(){return{}},mounted(){},methods:{emOk:function(e){}}},n=(0,a(1001).Z)(l,(function(){var e=this._self._c;return e("div",[e("Files")],1)}),[],!1,null,"40c3bcfc",null).exports},2670:function(e,t,a){a.d(t,{AS:function(){return r},en:function(){return l},v6:function(){return n}});var i=a(55743),s=a.n(i);const l={data(){return{dQparm:{},dTb:{rows:[],colunms:[],rows_chks:[],load:!1,pagination:{current:1,total:0,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`共${e}条数据 当前从${t[0]}~${t[1]}条`},size:"defalut"}}},mounted(){this.dTb.colunms=this.schema.ListCols,this.fnTb_Query()},methods:{async fnTb_Query(e,t,a){this.dTb.pagination.current=e&&e.current||1,this.dTb.pagination.pageSize=e&&e.pageSize||10,this.dQparm.pageIndex=this.dTb.pagination.current,this.dQparm.pageSize=this.dTb.pagination.pageSize,this.dTb.load=!0;let i=await this.$api2(this.schema.Url.GetCount,this.dQparm);if(i.isOk){let e=parseInt(i.data);if(e>0){this.dTb.pagination.total=e;let t=await this.$api2(this.schema.Url.GetList,this.dQparm);t.isOk?this.dTb.rows=this.schema.ListFilter&&await this.schema.ListFilter(t.data)||t.data:this.$message.error(t&&t.message||this.schema.Desc+"数据列表查询失败")}else this.dTb.rows=[]}else this.$message.error(i&&i.message||this.schema.Desc+"数据分页统计失败");this.dTb.load=!1},async fnTb_Del(e){if(!e||e.length<=0)return this.$message.error("请选择要删除的"+this.schema.Desc+"数据");let t=this;this.$confirm({title:"操作确认",content:"确认删除当前选中的"+e.length+"条记录",onOk(){t.$api2(t.schema.Url.Delete,e).then((e=>{e&&e.isOk?(t.$message.success(t.schema.Desc+"数据已成功删除"),t.fnTb_Query()):t.$message.error(e&&e.message||"数据删除失败")}))}})}},filters:{time(e,t="YYYY-MM-DD HH:mm:ss"){let a=s()(e);return a.isValid()?a.format(t):null}}},n={data(){return{dObj:{show:!1,load:!1,mod:null,title:""}}},mounted(){this.dObj.title=this.schema&&this.schema.Desc||""},methods:{async Init(e,t="fid"){if(!(e&&e>0))return;this.dObj.mod=null,this.dObj.show=!0,this.dObj.load=!0;let a="fid"==t?{fid:e}:{id:e},i=await this.$api2(this.schema.Url.Get,null,a);this.dObj.load=!1,i&&i.isOk&&null!=i.data?this.dObj.mod=this.schema.DetailFilter&&await this.schema.DetailFilter(i.data)||i.data:this.$message.error(i&&i.message||this.schema.Desc+"可预览信息查询失败")}}},r={data(){return{dObj:{show:!1,load:!1,mod:null,title:"",rules:null}}},mounted(){this.dObj.title=this.schema.Desc||"",this.dObj.rules=this.schema.EditRules||null},methods:{async Init(e,t="fid"){if(parseInt(e)>=0){if(this.dObj.mod=null,this.dObj.show=!0,0==e)this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(null);else{this.dObj.load=!0;let a="fid"==t?{fid:e}:{id:e},i=await this.$api2(this.schema.Url.Get,null,a);i&&i.isOk&&null!=i.data?this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(i.data)||i.data:this.$message.error(i&&i.message||this.schema.Desc+"可编辑信息查询失败"),this.dObj.load=!1}this.$refs.editref&&this.$refs.editref.resetFields&&this.$refs.editref.resetFields()}},async Save(){this.$refs.editref.validate((async e=>{if(!e)return this.$message.error("输入数据校验失败，请重新输入"),!1;{this.dObj.load=!0;let e=this.schema.SaveFilter&&this.schema.SaveFilter(this.dObj.mod)||this.dObj.mod,t=await this.$api2(this.schema.Url.Save,e);this.dObj.load=!1,t&&t.isOk?parseInt(t.data)>0?(this.$message.success(this.schema.Desc+"数据保存成功"),this.schema.SaveFilterEnd&&(this.dObj.mod.fid=t.data,this.schema.SaveFilterEnd(this.dObj.mod)),this.dObj.show=!1,this.$emit("emOk",!0)):this.$message.error("数据保存失败"):this.$message.error(t&&t.message||this.schema.Desc+"数据保存失败")}}))},async Cancel(){this.dObj.show=!1,this.dObj.mod=null}}}},28511:function(e,t,a){var i=a(55743),s=a.n(i);let l={Desc:"附件数据",Table:"Attachment",TableType:"Common"};l.Url={Save:`/api/${l.TableType}/Save${l.Table}s`,GetCount:`/api/${l.TableType}/Get${l.Table}Count`,GetList:`/api/${l.TableType}/Get${l.Table}List`,Get:`/api/${l.TableType}/Get${l.Table}`,Delete:`/api/${l.TableType}/Delete${l.Table}s`},l.ListCols=[{title:"序号",dataIndex:"ix",show:!0,scopedSlots:{customRender:"ix"},width:80},{title:"编号",dataIndex:"fid",show:!1},{title:"文件名称",dataIndex:"name",show:!0,ellipsis:!0},{title:"归属ID",dataIndex:"tableID",show:!1},{title:"归属名",dataIndex:"tableName",show:!0,scopedSlots:{customRender:"tableName"},width:100},{title:"格式",dataIndex:"relativePath_suffix",show:!0,scopedSlots:{customRender:"relativePath_suffix"},width:80},{title:"更新日期",dataIndex:"uploadDate",show:!0,width:170},{title:"预览",dataIndex:"relativePath",show:!0,scopedSlots:{customRender:"relativePath"},width:180},{title:"操作",dataIndex:"op",show:!0,scopedSlots:{customRender:"op"},width:180}],l.ListFilter=e=>{let t=[...e];return t.map((e=>{e.uploadDate=s()(e.uploadDate).isValid()?s()(e.uploadDate).format("YYYY-MM-DD HH:mm:ss"):null})),t},l.DetailFilter=e=>(e.uploadDate=s()(e.uploadDate).format("YYYY-MM-DD HH:mm:ss"),e),l.EditRules={name:[{required:!0,message:"请输入文件名",trigger:"blur"}],tableName:[{required:!0,message:"请选择文件归属",trigger:"blur"}],tableID:[{required:!0,message:"请输入文件归属ID",trigger:"blur"}],relativePath:[{required:!0,trigger:"change",validator:async(e,t)=>t&&t.length>0?Promise.resolve():Promise.reject("请选择文件上传")}]},l.EditFilter=e=>Object.assign({fid:0,name:"",relativePath:"",tableID:null,tableName:"",uploadDate:null},e),l.SaveFilter=e=>(e.uploadDate=s()().toJSON(),[e]),t.Z=l}}]);