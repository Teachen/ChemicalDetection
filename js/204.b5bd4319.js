"use strict";(self.webpackChunkChemicalDetection=self.webpackChunkChemicalDetection||[]).push([[204],{42722:function(e,t,a){a.d(t,{Z:function(){return i}});var s={data(){return{dnofold:!1,dunflod:!1,newkeyWord:this.keyWord}},props:{keyWord:String||"",loading:Boolean||!1,nofold:Boolean||!1,unflod:Boolean||!1,btnlg:Number||8},emits:["emReset","emQuery","update:keyWord"],created(){this.dnofold=Boolean(this.nofold),this.dunflod=Boolean(this.unflod)},methods:{fnTest(){}}},i=(0,a(1001).Z)(s,(function(){var e=this,t=e._self._c;return t("div",[t("a-form",{directives:[{name:"show",rawName:"v-show",value:!e.dunflod,expression:"!dunflod"}],staticClass:"inline-form",staticStyle:{"margin-bottom":"10px",display:"flex","justify-content":"end"},attrs:{layout:"inline"}},[e._t("COND1",(function(){return[t("a-form-item",{attrs:{label:"关键字搜索"}},[t("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入搜索关键字",allowClear:""},on:{change:function(t){return e.$emit("update:keyWord",e.newkeyWord)},search:function(t){return e.$emit("emQuery",null)}},model:{value:e.newkeyWord,callback:function(t){e.newkeyWord=t},expression:"newkeyWord"}})],1)]})),t("a-form-item",{staticStyle:{"margin-right":"0"}},[t("a-space",[e._t("BTNS",(function(){return[t("a-button",{staticClass:"cant-btn-default",attrs:{type:"default",loading:e.loading},on:{click:function(t){return e.$emit("emReset",null)}}},[e._v("重置")]),t("a-button",{staticClass:"cant-btn-default",attrs:{type:"primary",loading:e.loading},on:{click:function(t){return e.$emit("emQuery",null)}}},[e._v("搜索")]),e.dnofold?e._e():[t("a-button",{directives:[{name:"show",rawName:"v-show",value:!e.dunflod,expression:"!dunflod"}],staticClass:"cant-btn-default",attrs:{type:"primary"},on:{click:function(t){e.dunflod=!e.dunflod}}},[e._v("高级"),t("a-icon",{staticClass:"icolorfff",attrs:{type:"caret-down"}})],1),t("a-button",{directives:[{name:"show",rawName:"v-show",value:e.dunflod,expression:"dunflod"}],staticClass:"cant-btn-default",attrs:{type:"primary"},on:{click:function(t){e.dunflod=!e.dunflod}}},[e._v("收起"),t("a-icon",{staticClass:"icolorfff",attrs:{type:"caret-up"}})],1)],e._t("BTNSPUSH")]}))],2)],1)],2),t("a-form",{directives:[{name:"show",rawName:"v-show",value:!e.dnofold&&e.dunflod,expression:"!dnofold && dunflod"}],staticClass:"inline-form",staticStyle:{"margin-bottom":"-10px"},attrs:{layout:"horizontal",labelCol:{style:{width:"100px"}}}},[t("a-row",{attrs:{gutter:[30,0]}},[e._t("COND2"),t("a-col",{attrs:{span:24,lg:e.btnlg}},[t("a-form-item",{staticClass:"fr"},[t("a-space",[e._t("BTNS",(function(){return[t("a-button",{staticClass:"cant-btn-default",attrs:{type:"default",loading:e.loading},on:{click:function(t){return e.$emit("emReset",null)}}},[e._v("重置")]),t("a-button",{staticClass:"cant-btn-default",attrs:{type:"primary",loading:e.loading},on:{click:function(t){return e.$emit("emQuery",null)}}},[e._v("搜索")]),e.dnofold?e._e():[t("a-button",{directives:[{name:"show",rawName:"v-show",value:!e.dunflod,expression:"!dunflod"}],staticClass:"cant-btn-default",attrs:{type:"primary"},on:{click:function(t){e.dunflod=!e.dunflod}}},[e._v("高级"),t("a-icon",{staticClass:"icolorfff",attrs:{type:"caret-down"}})],1),t("a-button",{directives:[{name:"show",rawName:"v-show",value:e.dunflod,expression:"dunflod"}],staticClass:"cant-btn-default",attrs:{type:"primary"},on:{click:function(t){e.dunflod=!e.dunflod}}},[e._v("收起"),t("a-icon",{staticClass:"icolorfff",attrs:{type:"caret-up"}})],1)],e._t("BTNSPUSH")]}))],2)],1)],1)],2)],1)],1)}),[],!1,null,null,null).exports},84204:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var s=a(2670),i=a(55743),r=a.n(i),l=a(26839),n=a(51223);let d={Desc:"用户",Url:{Save:"/api/BaseRFAdmin/Save_sys_user",GetCount:"/api/BaseRFAdmin/GetCount_sys_user",GetList:"/api/BaseRFAdmin/GetList_sys_user",Get:"/api/BaseRFAdmin/Get_sys_user",Delete:"/api/BaseRFAdmin/Delete_sys_user"},ListCols:[{title:"序号",dataIndex:"ix",show:!0,scopedSlots:{customRender:"ix"},width:80,className:"text-tc"},{title:"用户名",dataIndex:"name",show:!0},{title:"手机号",dataIndex:"phone",show:!0},{title:"角色",dataIndex:"roles",show:!0,scopedSlots:{customRender:"roles"}},{title:"部门",dataIndex:"dept_id",show:!0},{title:"数据权限",dataIndex:"data_permission",show:!0},{title:"状态",dataIndex:"lock_flag",show:!0,scopedSlots:{customRender:"lock_flag"}},{title:"创建时间",dataIndex:"create_time",show:!0},{title:"更新时间",dataIndex:"update_time",show:!1},{title:"操作",dataIndex:"op",show:!0,scopedSlots:{customRender:"op"},fixed:"right",width:300,className:"text-tc"}],ListFilter:async e=>{let t=await(0,l.pr)(),a=await(0,l.Vc)(),s=[...e];return s.map((e=>{e.create_time=r()(e.create_time).isValid()?r()(e.create_time).format("YYYY-MM-DD HH:mm:ss"):null,e.update_time=r()(e.update_time).isValid()?r()(e.update_time).format("YYYY-MM-DD HH:mm:ss"):null,e.dept_id=(0,n.cf)(t,"id",e.dept_id,"name"),e.data_permission=(a.find((t=>t.id==e.data_permission))||{value:""}).value,e.roles=e.roles.map((e=>e.name))})),s},DetailFilter:async e=>{let t=await(0,l.pr)(),a=await(0,l.Vc)();return e.create_time=r()(e.create_time).isValid()?r()(e.create_time).format("YYYY-MM-DD HH:mm:ss"):null,e.update_time=r()(e.update_time).isValid()?r()(e.update_time).format("YYYY-MM-DD HH:mm:ss"):null,e.dept_id=(0,n.cf)(t,"id",e.dept_id,"name"),e.roles=e.roles.map((e=>e.name)),e.data_permission=(a.find((t=>t.id==e.data_permission))||{value:""}).value,e}};d.EditRules={name:[{required:!0,message:"请输入用户名",trigger:"change"}],dept_id:[{required:!0,message:"请选择所属部门",trigger:"change"}],password:[{required:!0,message:"请输入用户密码",trigger:"change"}],phone:[{required:!0,message:"请输入联系手机号",trigger:"change"}],roles:[{required:!0,trigger:"change",type:"array",validator:async(e,t)=>null!=t&&t.length>=0?Promise.resolve():Promise.reject("请选择用户角色")}],isadmin:[{required:!0,trigger:"change",type:"array",validator:async(e,t)=>"boolean"==typeof t?Promise.resolve():Promise.reject("请选择是否管理员")}],data_permission:[{required:!0,message:"请选择数据权限",trigger:"change"}],lock_flag:[{required:!0,message:"请选择状态",trigger:"change"}]},d.EditFilter=e=>(null!=e&&(e.roles=null==e.roles?[]:e.roles.map((e=>e.id)),e.lock_flag=1==e.lock_flag?1:0,e.password="",null==e.isadmin&&(e.isadmin=void 0)),Object.assign({id:0,password:""},e)),d.SaveFilter=e=>{let t=Object.assign({},e);return t.roles=null==t.roles?[]:t.roles.map((e=>({id:e}))),t.lock_flag=1==t.lock_flag?1:0,null!=t.password&&0==t.password.length&&(t.password=null),t};var o=d,c=a(42722),m={inject:["pGrand"],data(){return{dQparm:{name:"",dept_id:0,startDate:null,endDate:null}}},props:{loading:{type:Boolean,default:!1}},components:{TableQuery:c.Z},async created(){this.fnReset(),this.init()},methods:{async init(){},fnReset(){this.dQparm={name:"",startDate:null,endDate:null,dept_id:0}},fnQuery(){let e={};this.dQparm.name&&this.dQparm.name.length>0&&(e.name=this.dQparm.name.trim()),this.dQparm.startDate&&r()(this.dQparm.startDate).isValid()&&(e.startDate=this.dQparm.startDate.toJSON()),this.dQparm.endDate&&r()(this.dQparm.endDate).isValid()&&(e.endDate=this.dQparm.endDate.toJSON()),this.dQparm.dept_id&&this.dQparm.dept_id>0&&(e.dept_id=this.dQparm.dept_id),this.$emit("emQuery",e)}}},u=a(1001),p=(0,u.Z)(m,(function(){var e=this,t=e._self._c;return t("TableQuery",{attrs:{keyWord:e.dQparm.name,loading:e.loading,btnlg:16},on:{"update:keyWord":function(t){return e.$set(e.dQparm,"name",t)},"update:key-word":function(t){return e.$set(e.dQparm,"name",t)},emReset:e.fnReset,emQuery:e.fnQuery},scopedSlots:e._u([{key:"COND2",fn:function(){return[t("a-col",{attrs:{span:24,lg:8}},[t("a-form-item",{attrs:{label:"搜索内容"}},[t("a-input-search",{attrs:{placeholder:"请输入搜索内容",allowClear:""},on:{search:function(t){return e.fnQuery()}},model:{value:e.dQparm.name,callback:function(t){e.$set(e.dQparm,"name",t)},expression:"dQparm.name"}})],1)],1),t("a-col",{attrs:{span:24,lg:8}},[t("a-form-item",{attrs:{label:"选择部门"}},[t("a-tree-select",{attrs:{"show-search":"",treeData:e.pGrand.dSysDept,replaceFields:{title:"name",value:"id",key:"id"},placeholder:"选择用户部门",searchPlaceholder:"请输入关键字过滤","allow-clear":"",treeNodeFilterProp:"title"},model:{value:e.dQparm.dept_id,callback:function(t){e.$set(e.dQparm,"dept_id",t)},expression:"dQparm.dept_id"}})],1)],1),t("a-col",{attrs:{span:24,lg:8}},[t("a-form-item",{attrs:{label:"查询起始时间"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入起始时间","show-time":""},model:{value:e.dQparm.startDate,callback:function(t){e.$set(e.dQparm,"startDate",t)},expression:"dQparm.startDate"}})],1)],1),t("a-col",{attrs:{span:24,lg:8}},[t("a-form-item",{attrs:{label:"查询终止时间"}},[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入终止时间","show-time":""},model:{value:e.dQparm.endDate,callback:function(t){e.$set(e.dQparm,"endDate",t)},expression:"dQparm.endDate"}})],1)],1)]},proxy:!0},{key:"BTNSPUSH",fn:function(){return[t("a-button",{staticClass:"cant-btn-default",attrs:{type:"primary"},on:{click:function(t){return e.$emit("emAdd",null)}}},[e._v("添加")])]},proxy:!0}])})}),[],!1,null,null,null).exports,h={extends:s.AS,inject:["pGrand"],data(){return{schema:o}}},f=(0,u.Z)(h,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{visible:e.dObj.show,title:(e.dObj.mod&&e.dObj.mod.id>0?"编辑":"新增")+e.dObj.title,width:860,maskClosable:!1},on:{ok:function(t){return e.Save()},cancel:function(t){return e.Cancel()}}},[t("a-spin",{attrs:{spinning:e.dObj.load,tip:e.dObj.title+"可编辑数据加载中..."}},[t("div",{style:e.dObj.load?"min-height:280px":""},[null!=e.dObj.mod?t("a-form-model",{ref:"editref",staticClass:"inline-form",attrs:{model:e.dObj.mod,rules:e.dObj.rules,labelCol:{style:{width:"120px"}},layout:"horizontal",labelAlign:"left"}},[t("input",{attrs:{type:"hidden"},domProps:{value:e.dObj.mod.fid}}),t("a-row",{staticClass:"column2",staticStyle:{"margin-right":"0"},attrs:{gutter:[32,0]}},[t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"用户名",prop:"name"}},[t("a-input",{attrs:{placeholder:"请输入用户名",allowClear:""},model:{value:e.dObj.mod.name,callback:function(t){e.$set(e.dObj.mod,"name",t)},expression:"dObj.mod.name"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"密码",prop:0==e.dObj.mod.id?"password":"passwordno"}},[t("a-input-password",{attrs:{placeholder:"请输入密码",allowClear:""},model:{value:e.dObj.mod.password,callback:function(t){e.$set(e.dObj.mod,"password",t)},expression:"dObj.mod.password"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"手机号",prop:"phone"}},[t("a-input",{attrs:{placeholder:"请输入手机号",allowClear:""},model:{value:e.dObj.mod.phone,callback:function(t){e.$set(e.dObj.mod,"phone",t)},expression:"dObj.mod.phone"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"状态",prop:"lock_flag"}},[t("a-select",{attrs:{placeholder:"请选择用户状态",allowClear:""},model:{value:e.dObj.mod.lock_flag,callback:function(t){e.$set(e.dObj.mod,"lock_flag",t)},expression:"dObj.mod.lock_flag"}},[t("a-select-option",{key:"1",attrs:{value:1}},[e._v("锁定")]),t("a-select-option",{key:"0",attrs:{value:0}},[e._v("有效")])],1)],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"管理员",prop:"isadmin"}},[t("a-select",{attrs:{placeholder:"请选择是否管理员",allowClear:""},model:{value:e.dObj.mod.isadmin,callback:function(t){e.$set(e.dObj.mod,"isadmin",t)},expression:"dObj.mod.isadmin"}},[t("a-select-option",{attrs:{value:!0}},[e._v("是")]),t("a-select-option",{attrs:{value:!1}},[e._v("否")])],1)],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-model-item",{attrs:{label:"数据权限",prop:"data_permission"}},[t("a-tree-select",{attrs:{"show-search":"",treeData:e.pGrand.dSysPermission,replaceFields:{title:"value",value:"id",key:"id"},placeholder:"选择数据权限",searchPlaceholder:"请输入关键字过滤","allow-clear":"",treeNodeFilterProp:"title"},model:{value:e.dObj.mod.data_permission,callback:function(t){e.$set(e.dObj.mod,"data_permission",t)},expression:"dObj.mod.data_permission"}})],1)],1),t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"部门",prop:"dept_id"}},[t("a-tree-select",{attrs:{"show-search":"",treeData:e.pGrand.dSysDept[0].children,replaceFields:{title:"name",value:"id",key:"id"},placeholder:"选择用户部门",searchPlaceholder:"请输入关键字过滤","allow-clear":"",treeNodeFilterProp:"title"},model:{value:e.dObj.mod.dept_id,callback:function(t){e.$set(e.dObj.mod,"dept_id",t)},expression:"dObj.mod.dept_id"}})],1)],1),t("a-col",{attrs:{span:24}},[t("a-form-model-item",{attrs:{label:"角色",prop:"roles"}},[t("a-select",{attrs:{placeholder:"请选择角色",allowClear:"",mode:"multiple",options:e.pGrand.dSysRole},model:{value:e.dObj.mod.roles,callback:function(t){e.$set(e.dObj.mod,"roles",t)},expression:"dObj.mod.roles"}})],1)],1)],1)],1):t("a-empty",{directives:[{name:"show",rawName:"v-show",value:!e.dObj.load,expression:"!dObj.load"}]})],1)])],1)}),[],!1,null,null,null).exports,b={extends:s.v6,inject:["pGrand"],data(){return{schema:o}}},_=(0,u.Z)(b,(function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{visible:e.dObj.show,title:e.dObj.title+"详情",maskClosable:!1,width:860},on:{cancel:function(t){e.dObj.show=!1},ok:function(t){e.dObj.show=!1}}},[t("a-spin",{attrs:{spinning:e.dObj.load,tip:e.dObj.title+"详情数据加载中..."}},[t("div",{style:e.dObj.load?"min-height:280px":""},[e.dObj.mod?[t("a-descriptions",{attrs:{column:2,contentStyle:{opacity:.75},bordered:""}},[t("a-descriptions-item",{attrs:{label:"用户名",span:2}},[e._v(e._s(e.dObj.mod.name))]),t("a-descriptions-item",{attrs:{label:"部门",span:1}},[e._v(e._s(e.dObj.mod.dept_id))]),t("a-descriptions-item",{attrs:{label:"手机号",span:1}},[e._v(e._s(e.dObj.mod.phone))]),t("a-descriptions-item",{attrs:{label:"状态",span:1}},[1==e.dObj.mod.lock_flag?t("a-tag",{attrs:{color:"orange"}},[e._v("锁定")]):t("a-tag",{attrs:{color:"purple"}},[e._v("有效")])],1),t("a-descriptions-item",{attrs:{label:"数据权限",span:1}},[t("a-tag",{attrs:{color:"cyan"}},[e._v(e._s(e.dObj.mod.data_permission))])],1),t("a-descriptions-item",{attrs:{label:"创建人",span:1}},[e._v(e._s(e.dObj.mod.create_by))]),t("a-descriptions-item",{attrs:{label:"创建时间",span:1}},[e._v(e._s(e.dObj.mod.create_time))]),t("a-descriptions-item",{attrs:{label:"更新人",span:1}},[e._v(e._s(e.dObj.mod.update_by))]),t("a-descriptions-item",{attrs:{label:"更新时间",span:1}},[e._v(e._s(e.dObj.mod.update_time))]),t("a-descriptions-item",{attrs:{label:"分配角色",span:2}},e._l(e.dObj.mod.roles,(function(a,s){return t("a-tag",{key:s},[e._v(e._s(a))])})),1)],1)]:t("a-empty",{directives:[{name:"show",rawName:"v-show",value:!e.dObj.load,expression:"!dObj.load"}]})],2)])],1)}),[],!1,null,null,null).exports,y={extends:s.en,data(){return{schema:o,dSysDept:[],dSysRole:[],dSysDept:[],dSysPermission:[]}},components:{IndexQuery:p,IndexEdit:f,IndexDetail:_},provide:function(){return{pGrand:this}},async mounted(){this.dSysRole=await(0,l.W7)(!0),this.dSysDept=await(0,l.pr)(!0),this.dSysPermission=await(0,l.Vc)()},methods:{}},g=(0,u.Z)(y,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"main"},[t("IndexQuery",{attrs:{loading:e.dTb.load},on:{emQuery:t=>{e.dQparm=t,e.fnTb_Query()},emAdd:function(t){return e.$refs.refIndexEdit.Init(0)}}}),t("a-table",{attrs:{columns:e.dTb.colunms.filter((e=>e.show)),rowKey:e=>e.id,dataSource:e.dTb.rows,pagination:e.dTb.pagination,loading:e.dTb.load,"row-selection":{selectedRowKeys:e.dTb.rows_chks,onChange:t=>e.dTb.rows_chks=[...t]}},on:{change:e.fnTb_Query},scopedSlots:e._u([{key:"ix",fn:function(a,s,i){return t("span",{},[e._v(e._s((e.dTb.pagination.current-1)*e.dTb.pagination.pageSize+i+1)+" ")])}},{key:"IndexType",fn:function(a,s,i){return t("span",{},[e._v(e._s(a.name))])}},{key:"op",fn:function(a,s,i){return[t("a-button",{attrs:{type:"link",size:"small",icon:"eye"},on:{click:function(t){return e.$refs.refIndexDetail.Init(s.id,"id")}}},[e._v("查看")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-button",{attrs:{type:"link",size:"small",icon:"edit"},on:{click:function(t){return e.$refs.refIndexEdit.Init(s.id,"id")}}},[e._v("编辑")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-button",{attrs:{type:"link",size:"small",icon:"delete"},on:{click:function(t){return e.fnTb_Del([s.id])}}},[e._v("删除")])]}},{key:"lock_flag",fn:function(a){return[1==a?t("a-tag",{attrs:{color:"orange"}},[e._v("锁定")]):t("a-tag",{attrs:{color:"purple"}},[e._v("有效")])]}},{key:"roles",fn:function(a,s,i){return e._l(a,(function(a,s){return t("a-tag",{key:s},[e._v(e._s(a))])}))}}])}),t("IndexEdit",{ref:"refIndexEdit",on:{emOk:function(t){return e.fnTb_Query()}}}),t("IndexDetail",{ref:"refIndexDetail"})],1)}),[],!1,null,null,null).exports},2670:function(e,t,a){a.d(t,{AS:function(){return n},en:function(){return r},v6:function(){return l}});var s=a(55743),i=a.n(s);const r={data(){return{dQparm:{},dTb:{rows:[],colunms:[],rows_chks:[],load:!1,pagination:{current:1,total:0,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`共${e}条数据 当前从${t[0]}~${t[1]}条`},size:"defalut"}}},mounted(){this.dTb.colunms=this.schema.ListCols,this.fnTb_Query()},methods:{async fnTb_Query(e,t,a){this.dTb.pagination.current=e&&e.current||1,this.dTb.pagination.pageSize=e&&e.pageSize||10,this.dQparm.pageIndex=this.dTb.pagination.current,this.dQparm.pageSize=this.dTb.pagination.pageSize,this.dTb.load=!0;let s=await this.$api2(this.schema.Url.GetCount,this.dQparm);if(s.isOk){let e=parseInt(s.data);if(e>0){this.dTb.pagination.total=e;let t=await this.$api2(this.schema.Url.GetList,this.dQparm);t.isOk?this.dTb.rows=this.schema.ListFilter&&await this.schema.ListFilter(t.data)||t.data:this.$message.error(t&&t.message||this.schema.Desc+"数据列表查询失败")}else this.dTb.rows=[]}else this.$message.error(s&&s.message||this.schema.Desc+"数据分页统计失败");this.dTb.load=!1},async fnTb_Del(e){if(!e||e.length<=0)return this.$message.error("请选择要删除的"+this.schema.Desc+"数据");let t=this;this.$confirm({title:"操作确认",content:"确认删除当前选中的"+e.length+"条记录",onOk(){t.$api2(t.schema.Url.Delete,e).then((e=>{e&&e.isOk?(t.$message.success(t.schema.Desc+"数据已成功删除"),t.fnTb_Query()):t.$message.error(e&&e.message||"数据删除失败")}))}})}},filters:{time(e,t="YYYY-MM-DD HH:mm:ss"){let a=i()(e);return a.isValid()?a.format(t):null}}},l={data(){return{dObj:{show:!1,load:!1,mod:null,title:""}}},mounted(){this.dObj.title=this.schema&&this.schema.Desc||""},methods:{async Init(e,t="fid"){if(!(e&&e>0))return;this.dObj.mod=null,this.dObj.show=!0,this.dObj.load=!0;let a="fid"==t?{fid:e}:{id:e},s=await this.$api2(this.schema.Url.Get,null,a);this.dObj.load=!1,s&&s.isOk&&null!=s.data?this.dObj.mod=this.schema.DetailFilter&&await this.schema.DetailFilter(s.data)||s.data:this.$message.error(s&&s.message||this.schema.Desc+"可预览信息查询失败")}}},n={data(){return{dObj:{show:!1,load:!1,mod:null,title:"",rules:null}}},mounted(){this.dObj.title=this.schema.Desc||"",this.dObj.rules=this.schema.EditRules||null},methods:{async Init(e,t="fid"){if(parseInt(e)>=0){if(this.dObj.mod=null,this.dObj.show=!0,0==e)this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(null);else{this.dObj.load=!0;let a="fid"==t?{fid:e}:{id:e},s=await this.$api2(this.schema.Url.Get,null,a);s&&s.isOk&&null!=s.data?this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(s.data)||s.data:this.$message.error(s&&s.message||this.schema.Desc+"可编辑信息查询失败"),this.dObj.load=!1}this.$refs.editref&&this.$refs.editref.resetFields&&this.$refs.editref.resetFields()}},async Save(){this.$refs.editref.validate((async e=>{if(!e)return this.$message.error("输入数据校验失败，请重新输入"),!1;{this.dObj.load=!0;let e=this.schema.SaveFilter&&this.schema.SaveFilter(this.dObj.mod)||this.dObj.mod,t=await this.$api2(this.schema.Url.Save,e);this.dObj.load=!1,t&&t.isOk?parseInt(t.data)>0?(this.$message.success(this.schema.Desc+"数据保存成功"),this.schema.SaveFilterEnd&&(this.dObj.mod.fid=t.data,this.schema.SaveFilterEnd(this.dObj.mod)),this.dObj.show=!1,this.$emit("emOk",!0)):this.$message.error("数据保存失败"):this.$message.error(t&&t.message||this.schema.Desc+"数据保存失败")}}))},async Cancel(){this.dObj.show=!1,this.dObj.mod=null}}}}}]);