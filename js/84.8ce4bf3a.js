"use strict";(self.webpackChunkChemicalDetection=self.webpackChunkChemicalDetection||[]).push([[84],{27084:function(e,t,a){a.r(t),a.d(t,{default:function(){return o}});a(57658);var s=a(2670),i=a(77753),r={extends:s.AS,data(){return{labelCol:{span:6},wrapperCol:{span:12},schema:i.Z}},methods:{async fetchQuery(e){let t=this.$api2(this.schema.Url.query,e);t&&t.isOk&&(this.dObj.mod=t.data)},async fnSave(){this.$refs.editref.validate((async e=>{if(e){this.dObj.load=!0;let e=this.schema.SaveFilter&&this.schema.SaveFilter(this.dObj.mod)||this.dObj.mod;await this.$api2(this.schema.Url.Save,e);this.dObj.load=!1}}))}},created(){this.fetchQuery()}},l=a(1001),d={components:{addExternal:(0,l.Z)(r,(function(){var e=this,t=e._self._c;return t("div",[t("a-modal",{attrs:{visible:e.dObj.show,title:"新增"+e.dObj.title,maskClosable:!1,width:860},on:{cancel:function(t){e.dObj.show=!1},ok:function(t){return e.fnSave()}}},[t("a-spin",{attrs:{spinning:e.dObj.load,tip:e.dObj.title+"详情数据加载中..."}},[t("div",{style:e.dObj.load?"min-height:280px":""},[null!=e.dObj.mod?t("a-form-model",{ref:"editref",attrs:{model:e.dObj.mod,rules:e.dObj.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-form-model-item",{attrs:{label:"数据源编号：",prop:"sourceCode"}},[t("a-input",{attrs:{maxLength:50,placeholder:"请输入数据源编号",allowClear:""},model:{value:e.dObj.mod.sourceCode,callback:function(t){e.$set(e.dObj.mod,"sourceCode",t)},expression:"dObj.mod.sourceCode"}})],1),t("a-form-model-item",{attrs:{label:"数据源名称：",prop:"sourceName"}},[t("a-input",{attrs:{maxLength:50,placeholder:"请输入数据源名称",allowClear:""},model:{value:e.dObj.mod.sourceName,callback:function(t){e.$set(e.dObj.mod,"sourceName",t)},expression:"dObj.mod.sourceName"}})],1),t("a-form-model-item",{attrs:{label:"数据来源：",prop:"dataSourceInfo"}},[t("a-select",{staticStyle:{width:"98%"},attrs:{allowClear:"",placeholder:"请输入数据来源"}},e._l(e.$DICT,(function(a,s){return t("a-select-option",{key:s,attrs:{value:a.fid}},[e._v(e._s(a.name))])})),1)],1),t("a-form-model-item",{attrs:{label:"备注：",prop:"remark"}},[t("a-input",{attrs:{type:"textarea",rows:3,maxLength:500,placeholder:"请输入备注",allowClear:""},model:{value:e.dObj.mod.remark,callback:function(t){e.$set(e.dObj.mod,"remark",t)},expression:"dObj.mod.remark"}})],1)],1):e._e()],1)])],1)],1)}),[],!1,null,null,null).exports},data(){return{dTb:{rows:[],colunms:[],rows_chks:[],load:!1,pagination:{current:1,total:0,pageSize:15},size:"middle"}}},methods:{goStickUp(e){this.$refs.Edit.Init(e.fid)},fnCustomRow(e,t){return{on:{click:t=>{this.goStickUp(e)}}}}},created(){let e=[{fid:1,serialNum:1,dataSourceName:"测试数据源",dataSource:"测试数据源",remark:"测试数据源"}];this.dTb.rows=e,this.dTb.pagination.total=e.length,this.dTb.colunms=[{title:"序号",dataIndex:"serialNum",width:80,align:"center",show:[0,1]},{title:"数据源名称",dataIndex:"dataSourceName",ellipsis:!0,width:220,align:"center",show:[0,1]},{title:"数据来源",dataIndex:"dataSource",ellipsis:!0,width:150,align:"center",show:[0,1]},{title:"备注",dataIndex:"remark",ellipsis:!0,width:150,align:"center",show:[0,1]},{title:"操作",dataIndex:"operation",width:100,scopedSlots:{customRender:"operation"},align:"center",show:[1]}]}},o=(0,l.Z)(d,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"mainmx"},[e._m(0),t("div",{staticClass:"main-con box main-deep-com heiall"},[t("div",{staticClass:"box-top flexce"},[t("a-button",{attrs:{icon:"plus"},on:{click:function(t){return e.$refs.Edit.Init(0)}}},[e._v("增加")]),t("a-button",{attrs:{icon:"form"},on:{click:function(t){return e.$router.push({name:"dataManagement"})}}},[e._v("数据管理")]),t("a-button",{attrs:{icon:"export"},on:{click:function(t){return e.$emit("fatherEnv")}}},[e._v("返回")])],1),t("div",{staticClass:"box-par box-tab"},[t("a-table",{attrs:{columns:e.dTb.colunms.filter((e=>e.show)),rowKey:e=>e.fid,loading:e.dTb.load,dataSource:e.dTb.rows,pagination:e.dTb.pagination,size:e.dTb.size,customRow:e.fnCustomRow},scopedSlots:e._u([{key:"operation",fn:function(a){return[t("a-button",{attrs:{size:"small"},on:{click:function(t){return e.goStickUp(a)}}},[e._v("维护")])]}}])})],1)]),t("addExternal",{ref:"Edit"})],1)}),[function(){var e=this._self._c;return e("div",{staticStyle:{"margin-bottom":"15px"}},[e("div",{staticClass:"main-tit-top"},[this._v("外部数据源管理")])])}],!1,null,"5e1c7cea",null).exports},2670:function(e,t,a){a.d(t,{AS:function(){return d},en:function(){return r},v6:function(){return l}});var s=a(55743),i=a.n(s);const r={data(){return{dQparm:{},dTb:{rows:[],colunms:[],rows_chks:[],load:!1,pagination:{current:1,total:0,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`共${e}条数据 当前从${t[0]}~${t[1]}条`},size:"defalut"}}},mounted(){this.dTb.colunms=this.schema.ListCols,this.fnTb_Query()},methods:{async fnTb_Query(e,t,a){this.dTb.pagination.current=e&&e.current||1,this.dTb.pagination.pageSize=e&&e.pageSize||10,this.dQparm.pageIndex=this.dTb.pagination.current,this.dQparm.pageSize=this.dTb.pagination.pageSize,this.dTb.load=!0;let s=await this.$api2(this.schema.Url.GetCount,this.dQparm);if(s.isOk){let e=parseInt(s.data);if(e>0){this.dTb.pagination.total=e;let t=await this.$api2(this.schema.Url.GetList,this.dQparm);t.isOk?this.dTb.rows=this.schema.ListFilter&&await this.schema.ListFilter(t.data)||t.data:this.$message.error(t&&t.message||this.schema.Desc+"数据列表查询失败")}else this.dTb.rows=[]}else this.$message.error(s&&s.message||this.schema.Desc+"数据分页统计失败");this.dTb.load=!1},async fnTb_Del(e){if(!e||e.length<=0)return this.$message.error("请选择要删除的"+this.schema.Desc+"数据");let t=this;this.$confirm({title:"操作确认",content:"确认删除当前选中的"+e.length+"条记录",onOk(){t.$api2(t.schema.Url.Delete,e).then((e=>{e&&e.isOk?(t.$message.success(t.schema.Desc+"数据已成功删除"),t.fnTb_Query()):t.$message.error(e&&e.message||"数据删除失败")}))}})}},filters:{time(e,t="YYYY-MM-DD HH:mm:ss"){let a=i()(e);return a.isValid()?a.format(t):null}}},l={data(){return{dObj:{show:!1,load:!1,mod:null,title:""}}},mounted(){this.dObj.title=this.schema&&this.schema.Desc||""},methods:{async Init(e,t="fid"){if(!(e&&e>0))return;this.dObj.mod=null,this.dObj.show=!0,this.dObj.load=!0;let a="fid"==t?{fid:e}:{id:e},s=await this.$api2(this.schema.Url.Get,null,a);this.dObj.load=!1,s&&s.isOk&&null!=s.data?this.dObj.mod=this.schema.DetailFilter&&await this.schema.DetailFilter(s.data)||s.data:this.$message.error(s&&s.message||this.schema.Desc+"可预览信息查询失败")}}},d={data(){return{dObj:{show:!1,load:!1,mod:null,title:"",rules:null}}},mounted(){this.dObj.title=this.schema.Desc||"",this.dObj.rules=this.schema.EditRules||null},methods:{async Init(e,t="fid"){if(parseInt(e)>=0){if(this.dObj.mod=null,this.dObj.show=!0,0==e)this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(null);else{this.dObj.load=!0;let a="fid"==t?{fid:e}:{id:e},s=await this.$api2(this.schema.Url.Get,null,a);s&&s.isOk&&null!=s.data?this.dObj.mod=this.schema.EditFilter&&await this.schema.EditFilter(s.data)||s.data:this.$message.error(s&&s.message||this.schema.Desc+"可编辑信息查询失败"),this.dObj.load=!1}this.$refs.editref&&this.$refs.editref.resetFields&&this.$refs.editref.resetFields()}},async Save(){this.$refs.editref.validate((async e=>{if(!e)return this.$message.error("输入数据校验失败，请重新输入"),!1;{this.dObj.load=!0;let e=this.schema.SaveFilter&&this.schema.SaveFilter(this.dObj.mod)||this.dObj.mod,t=await this.$api2(this.schema.Url.Save,e);this.dObj.load=!1,t&&t.isOk?parseInt(t.data)>0?(this.$message.success(this.schema.Desc+"数据保存成功"),this.schema.SaveFilterEnd&&(this.dObj.mod.fid=t.data,this.schema.SaveFilterEnd(this.dObj.mod)),this.dObj.show=!1,this.$emit("emOk",!0)):this.$message.error("数据保存失败"):this.$message.error(t&&t.message||this.schema.Desc+"数据保存失败")}}))},async Cancel(){this.dObj.show=!1,this.dObj.mod=null}}}},77753:function(e,t,a){var s=a(55743),i=a.n(s),r=a(48368);let l={Desc:"外部数据源",Url:{query:"/api/externalDataSource/query",Save:"/api/externalDataSource/addOrUpdate",GetList:"/api/externalDataSource/list",Delete:"/api/externalDataSource/delete"},DetailFilter:e=>(e.create_time=i()(e.create_time).isValid()?i()(e.create_time).format("YYYY-MM-DD HH:mm:ss"):null,e.update_time=i()(e.update_time).isValid()?i()(e.update_time).format("YYYY-MM-DD HH:mm:ss"):null,e),EditRules:{sourceCode:[{required:!0,message:"请输入数据源编号",trigger:"blur"}],sourceName:[{required:!0,message:"请输入数据源名称",trigger:"blur"}],dataSourceInfo:[{required:!0,message:"请输入数据来源",trigger:"blur"}]},EditFilter:e=>Object.assign({id:0},e),SaveFilter:e=>Object.assign({},e),SaveFilterEnd:async e=>{await(0,r.Z)("/api/Common/SaveAttachments",[{tableName:"t_hotnews",type:"Img",tableID:e.fid,relativePaths:e._Attachment_Img.map((e=>e.url))}])}};t.Z=l}}]);